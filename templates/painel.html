<h2>Painel do GarÃ§om</h2>

<div id="alerta" style="margin-bottom:20px;"></div>
<div id="painel"></div>

<script>
function atualizar(){
  fetch("/status")
  .then(r => r.json())
  .then(dados => {
    let html = ""
    let chamados = []

    for (let restaurante in dados){
      html += `<h3>${restaurante}</h3>`
      html += `<div style="display:grid;grid-template-columns:repeat(10,1fr);gap:8px;">`

      for (let mesa in dados[restaurante]){
        let ativo = dados[restaurante][mesa]

        if (ativo){
          chamados.push(`Mesa ${mesa}`)
        }

        let cor = ativo ? "#e74c3c" : "#2ecc71"

        html += `
          <button 
            style="
              background:${cor};
              padding:10px;
              color:white;
              border:none;
              border-radius:6px;
              font-weight:bold;
            "
            onclick="atender('${restaurante}',${mesa})">
            Mesa ${mesa}
          </button>
        `
      }

      html += "</div>"
    }

    // ALERTA NO TOPO
    if (chamados.length > 0){
      document.getElementById("alerta").innerHTML = `
        <div style="
          background:#f39c12;
          padding:15px;
          color:white;
          font-size:18px;
          border-radius:8px;
          font-weight:bold;
        ">
          ðŸ”” Chamado ativo: ${chamados.join(", ")}
        </div>
      `
    } else {
      document.getElementById("alerta").innerHTML = ""
    }

    document.getElementById("painel").innerHTML = html
  })
}

function atender(restaurante, mesa){
  fetch("/atender",{
    method:"POST",
    headers:{"Content-Type":"application/x-www-form-urlencoded"},
    body:`restaurante=${restaurante}&mesa=${mesa}`
  })
}

setInterval(atualizar, 5000)
atualizar()
</script>
